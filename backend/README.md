<div align="center">
  <img src="https://via.placeholder.com/150/4CAF50/FFFFFF?text=AGRO" alt="AgroSmart Logo" width="150">
  <h1>üå± AgroSmart Backend</h1>
  <h3>Sistema Inteligente de Gest√£o Agr√≠cola</h3>
  
  [![Node.js](https://img.shields.io/badge/Node.js-18.x-339933?logo=node.js&logoColor=white)](https://nodejs.org/)
  [![Express](https://img.shields.io/badge/Express-4.x-000000?logo=express&logoColor=white)](https://expressjs.com/)
  [![PostgreSQL](https://img.shields.io/badge/PostgreSQL-13+-336791?logo=postgresql&logoColor=white)](https://www.postgresql.org/)
  [![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
  [![Build Status](https://img.shields.io/github/actions/workflow/status/agrosmart/backend/ci.yml?branch=main)](https://github.com/agrosmart/backend/actions)
  [![Coverage Status](https://coveralls.io/repos/github/agrosmart/backend/badge.svg?branch=main)](https://coveralls.io/github/agrosmart/backend?branch=main)
  [![PRs Welcome](https://img.shields.io/badge/PRs-welcome-brightgreen.svg)](http://makeapullrequest.com)
  [![Contributor Covenant](https://img.shields.io/badge/Contributor%20Covenant-2.1-4baaaa.svg)](CODE_OF_CONDUCT.md)

  <p align="center">
    <a href="#-sobre">Sobre</a> ‚Ä¢
    <a href="#-recursos">Recursos</a> ‚Ä¢
    <a href="#-in√≠cio-r√°pido">In√≠cio R√°pido</a> ‚Ä¢
    <a href="#-documenta√ß√£o">Documenta√ß√£o</a> ‚Ä¢
    <a href="#-arquitetura">Arquitetura</a> ‚Ä¢
    <a href="#-contribui√ß√£o">Contribui√ß√£o</a>
  </p>
  
  [![Deploy to Heroku](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/deploy)
  [![Open in Gitpod](https://gitpod.io/button/open-in-gitpod.svg)](https://gitpod.io/#https://github.com/agrosmart/backend)
</div>

## üå± Sobre o Projeto

O **AgroSmart** √© uma plataforma inovadora de gest√£o agr√≠cola projetada para otimizar a produtividade no campo. Este reposit√≥rio cont√©m o backend da aplica√ß√£o, desenvolvido com tecnologias modernas e escal√°veis para atender √†s demandas do agroneg√≥cio.

### üéØ Objetivos

- Fornecer uma solu√ß√£o completa para gest√£o de culturas agr√≠colas
- Facilitar o monitoramento em tempo real das opera√ß√µes no campo
- Oferecer ferramentas para tomada de decis√£o baseada em dados
- Garantir seguran√ßa e escalabilidade na gest√£o de informa√ß√µes sens√≠veis

### üöÄ Tecnologias Principais

- **Backend**: Node.js com Express
- **Banco de Dados**: PostgreSQL com migra√ß√µes SQL
- **Autentica√ß√£o**: JWT + 2FA
- **Documenta√ß√£o**: Swagger/OpenAPI
- **Monitoramento**: Winston para logs
- **Testes**: Jest + Supertest
- **CI/CD**: GitHub Actions
- **Containeriza√ß√£o**: Docker

## ‚ú® Recursos Principais

### üîê Autentica√ß√£o e Autoriza√ß√£o
- Autentica√ß√£o JWT com refresh tokens
- Verifica√ß√£o em duas etapas (2FA) via e-mail e WhatsApp
- Controle de sess√µes ativas e revoga√ß√£o de tokens
- M√∫ltiplos n√≠veis de permiss√£o (admin, produtor, t√©cnico)

### üë• Gest√£o de Usu√°rios
- Cadastro com confirma√ß√£o por e-mail/WhatsApp
- Recupera√ß√£o de senha segura
- Perfis personaliz√°veis
- Upload de foto de perfil

### üõ°Ô∏è Seguran√ßa Avan√ßada
- Limite de tentativas de login (5 tentativas, bloqueio por 10s)
- Criptografia de ponta a ponta
- Prote√ß√£o contra ataques comuns (XSS, CSRF, SQL Injection)
- Headers de seguran√ßa configurados (Helmet, CORS)
- Rate limiting para preven√ß√£o de abuso

### üìä Gest√£o Agr√≠cola
- Cadastro de propriedades rurais
- Controle de culturas e safras
- Monitoramento de estoque
- Registro de atividades no campo
- Relat√≥rios personalizados

### üì± Integra√ß√µes
- Envio de notifica√ß√µes por e-mail
- Integra√ß√£o com WhatsApp para alertas
- Webhooks para sistemas externos
- API RESTful documentada

### üìù Documenta√ß√£o
- Documenta√ß√£o interativa da API (Swagger UI)
- Guia de instala√ß√£o e configura√ß√£o
- Exemplos de c√≥digo para todas as rotas
- Pol√≠ticas de seguran√ßa e privacidade

## üöÄ In√≠cio R√°pido

Siga estes passos para configurar o projeto localmente para desenvolvimento e teste.

### üìã Pr√©-requisitos

- [Node.js](https://nodejs.org/) 18.x ou superior
- [PostgreSQL](https://www.postgresql.org/) 13.x ou superior
- [NPM](https://www.npmjs.com/) 9.x ou superior
- [Git](https://git-scm.com/)
- [Docker](https://www.docker.com/) (opcional, para ambiente containerizado)

### üõ†Ô∏è Configura√ß√£o do Ambiente

1. **Clonar o reposit√≥rio**
   ```bash
   git clone https://github.com/agrosmart/backend.git
   cd backend
   ```

2. **Instalar depend√™ncias**
   ```bash
   npm install
   ```

3. **Configurar vari√°veis de ambiente**
   ```bash
   cp .env.example .env
   ```
   Edite o arquivo `.env` com suas configura√ß√µes locais.

4. **Configura√ß√£o do Banco de Dados**
   - Inicie o servidor PostgreSQL
   - Crie um banco de dados vazio
   - Atualize as configura√ß√µes no `.env`:
     ```env
     PGHOST=localhost
     PGUSER=seu_usuario
     PGPASSWORD=sua_senha
     PGDATABASE=agrosmart
     PGPORT=5432
     ```

5. **Executar migra√ß√µes**
   ```bash
   npm run migrate
   ```

6. **Popular banco de dados (opcional)**
   ```bash
   npm run seed
   ```

7. **Iniciar o servidor**
   ```bash
   # Modo desenvolvimento (com hot-reload)
   npm run dev
   
   # Modo produ√ß√£o
   npm start
   ```

8. **Acessar a aplica√ß√£o**
   - API: http://localhost:5001
   - Documenta√ß√£o: http://localhost:5001/api-docs
   - Health Check: http://localhost:5001/health

### üê≥ Usando Docker (opcional)

```bash
# Construir as imagens
docker-compose build

# Iniciar os containers
docker-compose up -d

# Visualizar logs
docker-compose logs -f
```

### üîß Instala√ß√£o

1. **Clonar o reposit√≥rio**
   ```bash
   git clone https://github.com/agrosmart/backend.git
   cd backend
   ```

2. **Instalar depend√™ncias**
   ```bash
   npm install
   ```

3. **Configurar ambiente**
   ```bash
   cp .env.example .env
   ```
   Edite o arquivo `.env` com suas configura√ß√µes locais.

4. **Configurar banco de dados**
   - Crie um banco de dados PostgreSQL
   - Atualize as configura√ß√µes no `.env`
   ```env
   PGHOST=localhost
   PGUSER=seu_usuario
   PGPASSWORD=sua_senha
   PGDATABASE=agrosmart
   PGPORT=5432
   ```

5. **Executar migra√ß√µes**
   ```bash
   npm run migrate
   ```

6. **Iniciar o servidor**
   ```bash
   # Modo desenvolvimento
   npm run dev
   
   # Modo produ√ß√£o
   npm start
   ```

7. **Acessar documenta√ß√£o**
   - API Docs: http://localhost:5001/api-docs
   - Health Check: http://localhost:5001/health

## üõ†Ô∏è Vari√°veis de Ambiente Principais

| Vari√°vel | Descri√ß√£o | Obrigat√≥rio | Padr√£o |
|----------|-----------|-------------|--------|
| `NODE_ENV` | Ambiente de execu√ß√£o | N√£o | `development` |
| `PORT` | Porta do servidor | N√£o | `5001` |
| `JWT_SECRET` | Chave secreta para JWT | Sim | - |
| `SESSION_SECRET` | Chave secreta para sess√µes | Sim | - |
| `PGHOST` | Host do PostgreSQL | Sim | `localhost` |
| `PGDATABASE` | Nome do banco de dados | Sim | - |
| `SMTP_HOST` | Servidor SMTP para e-mails | Sim* | - |
| `VONAGE_API_KEY` | Chave da API Vonage (WhatsApp) | N√£o | - |
| `RECAPTCHA_SECRET_KEY` | Chave do reCAPTCHA | N√£o | - |

> *: Obrigat√≥rio apenas se estiver usando confirma√ß√£o por e-mail

## üöÄ Come√ßando

### 1. Configura√ß√£o do Ambiente

1. Clone o reposit√≥rio:
   ```bash
   git clone https://github.com/seu-usuario/agrosmart-backend.git
   cd agrosmart-backend
   ```

2. Instale as depend√™ncias:
   ```bash
   npm install
   ```

3. Crie um arquivo `.env` na raiz do projeto com base no `.env.example`:
   ```bash
   cp .env.example .env
   ```

4. Configure as vari√°veis de ambiente no arquivo `.env`.

### 2. Configura√ß√£o do Banco de Dados

1. Certifique-se de ter o PostgreSQL instalado e em execu√ß√£o
2. Crie um banco de dados para o projeto
3. Atualize as configura√ß√µes de conex√£o no arquivo `.env`

### 3. Executando Migra√ß√µes

```bash
npm run migrate
```

## üèÉ‚Äç‚ôÇÔ∏è Executando o Projeto

### Modo Desenvolvimento

```bash
npm run dev
```

### Modo Produ√ß√£o

```bash
npm start
```

## üìö Documenta√ß√£o da API

A documenta√ß√£o da API est√° dispon√≠vel em `http://localhost:5001/api-docs` quando o servidor estiver em execu√ß√£o.

## üîí Autentica√ß√£o

O sistema utiliza JWT para autentica√ß√£o. Inclua o token nas requisi√ß√µes protegidas:

```
Authorization: Bearer <token>
```

## üîÑ Fluxos Principais

### 1. Autentica√ß√£o de Usu√°rio

#### Registro
```http
POST /api/auth/register
Content-Type: application/json

{
  "nome_completo": "Jo√£o Silva",
  "email": "joao@exemplo.com",
  "senha": "Senha@123",
  "telefone": "+5511999999999",
  "estado": "SP",
  "tipo_usuario": "produtor",
  "verificationMethod": "email"
}
```

#### Login
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "joao@exemplo.com",
  "senha": "Senha@123"
}
```

#### Verifica√ß√£o de Conta
```http
POST /api/auth/verify-account
Content-Type: application/json

{
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "code": "123456"
}
```

### 2. Autentica√ß√£o em Duas Etapas (2FA)

#### Habilitar 2FA
```http
POST /api/2fa/enable
Authorization: Bearer <token>
Content-Type: application/json

{
  "method": "email"
}
```

#### Verificar C√≥digo 2FA
```http
POST /api/2fa/verify
Authorization: Bearer <token>
Content-Type: application/json

{
  "code": "123456"
}
```

## üîí Seguran√ßa

### Medidas de Seguran√ßa Implementadas

- **Autentica√ß√£o Segura**
  - JWT com tempo de expira√ß√£o
  - Refresh tokens
  - Revoga√ß√£o de tokens

- **Prote√ß√£o de Dados**
  - Senhas criptografadas com bcrypt
  - Dados sens√≠veis ofuscados nos logs
  - Cabe√ßalhos de seguran√ßa com Helmet

- **Preven√ß√£o de Ataques**
  - Rate Limiting (100 requisi√ß√µes/15min por IP)
  - Prote√ß√£o contra XSS
  - Preven√ß√£o de SQL Injection
  - CORS configurado de forma restritiva
  - CSRF Protection

- **Monitoramento**
  - Logs de seguran√ßa
  - Auditoria de acessos
  - Detec√ß√£o de atividades suspeitas

## üß™ Testes

```bash
npm test
```

## üßπ Lint e Formata√ß√£o

```bash
# Verificar estilo de c√≥digo
npm run lint

# Formatar c√≥digo
npm run format
```

## üèóÔ∏è Estrutura do Projeto

```
agrosmart-backend/
‚îú‚îÄ‚îÄ config/                   # Configura√ß√µes da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ database.js           # Configura√ß√£o do banco de dados
‚îÇ   ‚îî‚îÄ‚îÄ swagger.js            # Configura√ß√£o do Swagger
‚îÇ
‚îú‚îÄ‚îÄ controllers/              # Controladores da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ authController.js     # Autentica√ß√£o de usu√°rios
‚îÇ   ‚îú‚îÄ‚îÄ twoFactorController.js # Controle 2FA
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ middleware/               # Middlewares
‚îÇ   ‚îú‚îÄ‚îÄ auth.js               # Autentica√ß√£o JWT
‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.js       # Tratamento de erros
‚îÇ   ‚îî‚îÄ‚îÄ rateLimit.js          # Limita√ß√£o de requisi√ß√µes
‚îÇ
‚îú‚îÄ‚îÄ migrations/               # Migra√ß√µes do banco de dados
‚îÇ   ‚îî‚îÄ‚îÄ *.sql                 # Arquivos SQL de migra√ß√£o
‚îÇ
‚îú‚îÄ‚îÄ models/                   # Modelos do banco de dados
‚îÇ   ‚îú‚îÄ‚îÄ User.js               # Modelo de usu√°rio
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ routes/                   # Defini√ß√£o de rotas
‚îÇ   ‚îú‚îÄ‚îÄ authRoutes.js         # Rotas de autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ twoFactorRoutes.js    # Rotas 2FA
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ services/                 # L√≥gica de neg√≥cios
‚îÇ   ‚îú‚îÄ‚îÄ authService.js        # Servi√ßos de autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ emailService.js       # Servi√ßo de e-mail
‚îÇ   ‚îú‚îÄ‚îÄ whatsappService.js    # Servi√ßo de WhatsApp
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ utils/                    # Utilit√°rios
‚îÇ   ‚îú‚îÄ‚îÄ logger.js             # Sistema de logs
‚îÇ   ‚îú‚îÄ‚îÄ migrate.js            # Utilit√°rio de migra√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ validators/               # Valida√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ authValidator.js      # Valida√ß√µes de autentica√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ .env.example              # Exemplo de vari√°veis de ambiente
‚îú‚îÄ‚îÄ .eslintrc.js              # Configura√ß√£o do ESLint
‚îú‚îÄ‚îÄ .gitignore                # Arquivos ignorados pelo Git
‚îú‚îÄ‚îÄ package.json              # Depend√™ncias e scripts
‚îî‚îÄ‚îÄ server.js                 # Ponto de entrada da aplica√ß√£o
```

## üë• Contribui√ß√£o

Contribui√ß√µes s√£o bem-vindas! Siga estes passos para contribuir:
1. Verifique as [issues abertas](https://github.com/agrosmart/backend/issues) ou abra uma nova issue
2. Fa√ßa um fork do projeto
3. Crie uma branch para sua feature (`git checkout -b feature/nova-feature`)
4. Adicione suas altera√ß√µes (`git add .`)
5. Fa√ßa o commit das altera√ß√µes (`git commit -m 'Adiciona nova feature'`)
6. Fa√ßa o push para a branch (`git push origin feature/nova-feature`)
7. Abra um Pull Request

### Padr√µes de C√≥digo

- Siga o [Guia de Estilo JavaScript](https://github.com/airbnb/javascript)
- Escreva testes para novas funcionalidades
- Atualize a documenta√ß√£o quando necess√°rio
- Mantenha o c√≥digo limpo e organizado

### Relatando Problemas

Ao relatar problemas, por favor inclua:
- Vers√£o do Node.js
- Ambiente (desenvolvimento/produ√ß√£o)
- Passos para reproduzir o problema
- Comportamento esperado vs. real
- Capturas de tela, se aplic√°vel

## üìä Arquitetura

### Estrutura de Diret√≥rios

```
agrosmart-backend/
‚îú‚îÄ‚îÄ config/               # Configura√ß√µes da aplica√ß√£o
‚îú‚îÄ‚îÄ controllers/          # L√≥gica dos controladores
‚îú‚îÄ‚îÄ middleware/           # Middlewares personalizados
‚îú‚îÄ‚îÄ migrations/           # Migra√ß√µes do banco de dados
‚îú‚îÄ‚îÄ models/              # Modelos do Sequelize
‚îú‚îÄ‚îÄ routes/              # Defini√ß√£o das rotas
‚îú‚îÄ‚îÄ services/            # L√≥gica de neg√≥cios
‚îú‚îÄ‚îÄ utils/               # Utilit√°rios e helpers
‚îú‚îÄ‚îÄ tests/               # Testes automatizados
‚îú‚îÄ‚îÄ validators/          # Valida√ß√µes de entrada
‚îî‚îÄ‚îÄ docs/                # Documenta√ß√£o adicional
```

### Padr√µes de Projeto

- **MVC** para organiza√ß√£o do c√≥digo
- **Repository Pattern** para acesso a dados
- **Service Layer** para l√≥gica de neg√≥cios
- **Dependency Injection** para melhor testabilidade

### Fluxo de Dados

1. **Requisi√ß√£o HTTP** ‚Üí 2. **Middleware** ‚Üí 3. **Rota** ‚Üí 4. **Valida√ß√£o** ‚Üí 5. **Controller** ‚Üí 6. **Service** ‚Üí 7. **Repository** ‚Üí 8. **Banco de Dados**

## üß™ Testes

```bash
# Executar todos os testes
npm test

# Executar testes com cobertura
npm run test:coverage

# Executar testes em modo watch
npm run test:watch
```

### Tipos de Testes

- **Testes Unit√°rios**: Testes isolados de fun√ß√µes e componentes
- **Testes de Integra√ß√£o**: Testes de fluxos completos da API
- **Testes E2E**: Testes de ponta a ponta

## üöÄ Implanta√ß√£o

### Pr√©-requisitos

- Servidor Linux (Ubuntu 20.04+ recomendado)
- Node.js 18+
- PostgreSQL 13+
- Nginx (como proxy reverso)
- PM2 (para gerenciamento de processos)

### Passos para Produ√ß√£o

1. Configurar vari√°veis de ambiente de produ√ß√£o
2. Construir a aplica√ß√£o
3. Configurar o banco de dados
4. Configurar servidor web (Nginx)
5. Configurar SSL (certbot)
6. Configurar monitoramento

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a Licen√ßa MIT - veja o arquivo [LICENSE](LICENSE) para detalhes.

## üë• Equipe

- **Matheus Yamanari** - Desenvolvedor Backend
- [Adicione seu nome aqui] - Seu cargo

## ü§ù Como Contribuir

Contribui√ß√µes s√£o o que tornam a comunidade de c√≥digo aberto um lugar incr√≠vel para aprender, inspirar e criar. Qualquer contribui√ß√£o que voc√™ fizer ser√° **muito apreciada**.

1. D√™ um Fork no projeto
2. Crie uma Branch para sua Feature (`git checkout -b feature/FeatureIncrivel`)
3. Adicione suas mudan√ßas (`git add .`)
4. Comite suas mudan√ßas (`git commit -m 'Adicionando uma feature incr√≠vel'`)
5. Fa√ßa o Push da Branch (`git push origin feature/FeatureIncrivel`)
6. Abra um Pull Request

## üìû Suporte

Para suporte, entre em contato conosco:

- Email: [suporte@agrosmart.com](mailto:suporte@agrosmart.com)
- Issues: [GitHub Issues](https://github.com/agrosmart/backend/issues)
- Discord: [Entre no nosso servidor](https://discord.gg/agrosmart)

## üåü Agradecimentos

- √Ä todos os contribuidores que dedicaram seu tempo para melhorar este projeto
- Aos mentores e revisores de c√≥digo
- √Ä comunidade de c√≥digo aberto por todo o suporte

---

<div align="center">
  <p>Desenvolvido com ‚ù§Ô∏è pela <strong>Equipe AgroSmart</strong></p>
  <p>¬© 2025 AgroSmart - Todos os direitos reservados</p>
  
  [![Twitter](https://img.shields.io/twitter/follow/agrosmart?style=social)](https://twitter.com/agrosmart)
  [![GitHub stars](https://img.shields.io/github/stars/agrosmart/backend?style=social)](https://github.com/agrosmart/backend/stargazers)
  [![GitHub forks](https://img.shields.io/github/forks/agrosmart/backend?style=social)](https://github.com/agrosmart/backend/network/members)
</div>
